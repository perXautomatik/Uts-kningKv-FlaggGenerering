/*-- auto-generated definition
create table #utskickSOCKENkartamförbud (AKEBÄCK               varchar(max),
					[34]                  int,
					[genomgångna socknar] varchar(max),
					[13]                  int,
					[20160915]            int
)
go



INSERT INTO #utskickSOCKENkartamförbud  VALUES
  (N'AKEBÄCK', 34, N'genomgångna socknar', 13, 20160915)
 ,(N'ALA', 43, N'genomgångna socknar', 5, 20111116)
,(N'ALSKOG', 66, N'genomgångna socknar', 0, 20180312)
,(N'ALVA', 78, N'genomgångna socknar', 2, 20101011)
,(N'ANGA', 45, N'genomgångna socknar', 6, 20120413)
,(N'ARDRE', 65, N'ej utskick', 0, null)
,(N'ATLINGBO', 51, N'genomgångna socknar', 13, 20160915)
,(N'BARA', 26, N'ej utskick', 0, null)
,(N'BARLINGBO', 30, N'genomgångna socknar', 3, 20110202)
,(N'BJÖRKE', 36, N'utskick', 0, 20201127)
,(N'BOGE', 3, N'genomgångna socknar', 4, 20110610)
,(N'BRO', 19, N'genomgångna socknar', 0, null)
,(N'BUNGE', 5, N'ej utskick', 0, null)
,(N'BURS', 72, N'genomgångna socknar', 0, 20180312)
,(N'BUTTLE', 42, N'genomgångna socknar', 5, 20111116)
,(N'BÄL', 12, N'genomgångna socknar', 4, 20110610)
,(N'DALHEM', 29, N'utskick', 0, 20201127)
,(N'EKE', 85, N'genomgångna socknar', 2, 20101011)
,(N'EKEBY', 22, N'genomgångna socknar', 3, 20110202)
,(N'EKSTA', 63, N'ej utskick', 0, null)
,(N'ENDRE', 31, N'genomgångna socknar', 3, 20110202)
,(N'ESKELHEM', 55, N'ej utskick', 0, null)
,(N'ETELHEM', 68, N'genomgångna socknar', 11, 20140520)
,(N'FARDHEM', 79, N'genomgångna socknar', 9, 20130405)
,(N'FIDE', 88, N'ej utskick', 0, null)
,(N'FLERINGE', 7, N'ej utskick', 0, null)
,(N'FOLE', 21, N'genomgångna socknar', 0, null)
,(N'FOLLINGBO', 33, N'genomgångna socknar', 0, 20190403)
,(N'FRÖJEL', 62, N'utskick', 0, 20201127)
,(N'FÅRÖ', 4, N'ej utskick', 0, null)
,(N'GAMMELGARN', 46, N'genomgångna socknar', 12, 20150528)
,(N'GANTHEM', 28, N'utskick', 0, 20201127)
,(N'GARDE', 67, N'genomgångna socknar', 11, 20140520)
,(N'GERUM', 80, N'genomgångna socknar', 9, 20130405)
,(N'GOTHEM', 25, N'genomgångna socknar', 6, 20120413)
,(N'GRÖTLINGBO', 86, N'ej utskick', 0, null)
,(N'GULDRUPE', 41, N'genomgångna socknar', 5, 20111116)
,(N'HABLINGBO', 83, N'ej utskick', 0, null)
,(N'HALL', 8, N'genomgångna socknar', 1, 20100512)
,(N'HALLA', 38, N'utskick', 0, 20201127)
,(N'HAMRA', 90, N'genomgångna socknar', 13, 20160915)
,(N'HANGVAR', 9, N'genomgångna socknar', 1, 20100512)
,(N'HAVDHEM', 84, N'ej utskick', 0, null)
,(N'HEJDE', 60, N'genomgångna socknar', 11, 20140520)
,(N'HEJDEBY', 32, N'genomgångna socknar', 0, 20190403)
,(N'HEJNUM', 13, N'genomgångna socknar', 4, 20110610)
,(N'HELLVI', 11, N'genomgångna socknar', 0, null)
,(N'HEMSE', 76, N'ej utskick', 0, null)
,(N'HOGRÄN', 52, N'genomgångna socknar', 8, 20121228)
,(N'HÖRSNE', 26, N'ej utskick', 0, null)
,(N'KLINTE', 61, N'utskick', 0, 20201127)
,(N'KRÄKLINGBO', 44, N'genomgångna socknar', 0, 20180312)
,(N'KÄLLUNGE', 23, N'ej utskick', 0, null)
,(N'LAU', 70, N'genomgångna socknar', 0, 20180312)
,(N'LEVIDE', 81, N'genomgångna socknar', 9, 20130405)
,(N'LINDE', 75, N'genomgångna socknar', 9, 20130405)
,(N'LOJSTA', 74, N'genomgångna socknar', 9, 20130405)
,(N'LOKRUME', 20, N'genomgångna socknar', 0, 20190403)
,(N'LUMMELUNDA', 16, N'genomgångna socknar', 12, 20150528)
,(N'LYE', 69, N'genomgångna socknar', 9, 20130405)
,(N'LÄRBRO', 10, N'genomgångna socknar', 10, 20131115)
,(N'MARTEBO', 17, N'genomgångna socknar', 0, 20190403)
,(N'MÄSTERBY', 58, N'genomgångna socknar', 11, 20140520)
,(N'NORRLANDA', 27, N'ej utskick', 0, null)
,(N'NÄR', 71, N'genomgångna socknar', 0, 20180312)
,(N'NÄS', 87, N'genomgångna socknar', 7, 20120924)
,(N'OTHEM', 2, N'genomgångna socknar', 10, 20131115)
,(N'ROMA', 35, N'utskick', 0, 20201127)
,(N'RONE', 77, N'genomgångna socknar', 2, 20101011)
,(N'RUTE', 6, N'genomgångna socknar', 0, null)
,(N'SANDA', 57, N'ej utskick', 0, null)
,(N'SILTE', 82, N'genomgångna socknar', 7, 20120924)
,(N'SJONHEM', 39, N'genomgångna socknar', 0, 20180312)
,(N'SPROGE', 64, N'genomgångna socknar', 7, 20120924)
,(N'STENKUMLA', 53, N'genomgångna socknar', 0, null)
,(N'STENKYRKA', 15, N'ej utskick', 0, null)
,(N'STÅNGA', 73, N'genomgångna socknar', 9, 20130405)
,(N'SUNDRE', 92, N'genomgångna socknar', 13, 20160915)
,(N'TINGSTÄDE', 14, N'genomgångna socknar', 10, 20131115)
,(N'TOFTA', 54, N'ej utskick', 0, null)
,(N'TRÄKUMLA', 49, N'genomgångna socknar', 0, 20190403)
,(N'VALL', 50, N'genomgångna socknar', 8, 20121228)
,(N'VALLSTENA', 24, N'ej utskick', 0, null)
,(N'VAMLINGBO', 91, N'genomgångna socknar', 13, 20160915)
,(N'VIKLAU', 37, N'genomgångna socknar', 13, 20160915)
,(N'VISBY', 1, N'genomgångna socknar', 0, 20190403)
,(N'VÄNGE', 40, N'genomgångna socknar', 5, 20111116)
,(N'VÄSKINDE', 18, N'genomgångna socknar', 8, 20121228)
,(N'VÄSTERGARN', 56, N'ej utskick', 0, null)
,(N'VÄSTERHEJDE', 48, N'genomgångna socknar', 0, 20190403)
,(N'VÄTE', 59, N'genomgångna socknar', 11, 20140520)
,(N'ÖJA', 89, N'ej utskick', 0, null)
,(N'ÖSTERGARN', 47, N'genomgångna socknar', 12, 20150528)
*/


select * from (
select socken,flaggor,[genomgångna socknar] utskick,[20160915] urtskickdat from
(
     left outer join
(SELECT FASTIGHET, SHAPE
		       FROM SDE_GSD.GNG.AY_0980) s on f.Shape.STWithin(s.shape) = 1

    ) s group by socken
    ) qw
inner join #utskickSOCKENkartamförbud u on u.[AKEBÄCK] = left(socken,len(u.[AKEBÄCK]))
where not(flaggor > 20 and [20160915] is not null) and not(flaggor < 20 and [20160915] is not null)
    ) q
where flaggor > 5 and utskick = 'ej utskick'
